<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:SmartRead.MVVM.ViewModels"
    xmlns:models="clr-namespace:SmartRead.MVVM.Models"
    x:Class="SmartRead.MVVM.Views.Book.SearchPage"
    x:DataType="vm:SearchViewModel"
    BackgroundColor="Black">

    <Grid RowDefinitions="Auto,*">
        <!-- Header -->
        <Grid
          Grid.Row="0"
          BackgroundColor="#1F1F1F"
          Padding="16"
          HeightRequest="80"
          HorizontalOptions="FillAndExpand"
          VerticalOptions="Start">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <SearchBar
                Grid.Column="0"
                Text="{Binding SearchText}"
                Placeholder="¿Qué quieres leer?"
                FontSize="14"
                TextColor="White"
                PlaceholderColor="#888"
                BackgroundColor="#353535"
                HeightRequest="40"
                HorizontalOptions="FillAndExpand"
                VerticalOptions="Center"
                SearchCommand="{Binding SearchCommand}"
                SearchCommandParameter="{Binding SearchText}" />    

            <ImageButton
                Grid.Column="1"
                Source="close.png"
                WidthRequest="36"
                HeightRequest="36"
                BackgroundColor="Transparent"
                Margin="12,0,0,0"
                HorizontalOptions="End"
                VerticalOptions="Center"
                Command="{Binding CloseSearchCommand}" />
                </Grid>

        <!-- Resultados: CollectionView sin ScrollView envolvente -->
        <CollectionView
          Grid.Row="1"
          ItemsSource="{Binding SearchResults}"
          SelectionMode="None"
          Margin="20,10"
          VerticalOptions="FillAndExpand"
          ItemSizingStrategy="MeasureFirstItem">

            <!-- EmptyView -->
            <CollectionView.EmptyView>
                <Label
                  Text="Sin resultados"
                  TextColor="#888"
                  HorizontalOptions="Center"
                  VerticalOptions="CenterAndExpand" />
            </CollectionView.EmptyView>

            <!-- Template -->
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Book">
                    <Frame
                        BackgroundColor="#2D2D2D"
                        CornerRadius="8"
                        Padding="10"
                        Margin="0,5">
                        <StackLayout Orientation="Horizontal" Spacing="10">
                            <Image
                                Source="{Binding CoverImageUrl}"
                                WidthRequest="50"
                                HeightRequest="70"
                                Aspect="AspectFill" />  
                            <StackLayout>
                                <Label
                                  Text="{Binding Title}"
                                  FontAttributes="Bold"
                                  TextColor="White" />
                                <Label
                                  Text="{Binding Author}"
                                  FontSize="12"
                                  TextColor="#ADADAD" />
                            </StackLayout>
                        </StackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>
